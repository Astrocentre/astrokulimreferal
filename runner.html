<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Working Endless Runner</title>
<style>
  html, body {
    margin: 0; padding: 0; height: 100%; overflow: hidden;
    background: linear-gradient(to top, #87ceeb, #ffffff);
    font-family: Arial, sans-serif;
  }
  canvas {
    display: block;
    background: #87ceeb;
  }
  #score {
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    color: white;
    font-size: 24px;
    font-weight: bold;
    text-shadow: 0 0 5px black;
    user-select: none;
    z-index: 10;
  }
  #startBtn, #restartBtn {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    background: #007acc;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 12px 30px;
    font-size: 20px;
    cursor: pointer;
    z-index: 20;
    user-select: none;
  }
  #startBtn {
    top: 40%;
  }
  #restartBtn {
    top: 50%;
    display: none;
  }
</style>
</head>
<body>

<canvas id="game"></canvas>
<div id="score">Score: 0</div>
<button id="startBtn">Start Game</button>
<button id="restartBtn">Restart</button>

<script>
(() => {
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const startBtn = document.getElementById('startBtn');
  const restartBtn = document.getElementById('restartBtn');
  const scoreUI = document.getElementById('score');

  let width, height;
  const groundHeight = 100;
  const gravity = 0.6;
  let gameSpeed = 6;
  let score = 0;
  let gameStarted = false;

  const player = {
    x: 100,
    y: 0,
    width: 60,
    height: 60,
    dy: 0,
    jumpForce: 15,
    grounded: true,
    color: '#FFD700'
  };

  let obstacles = [];

  function resize() {
    width = canvas.width = window.innerWidth;
    height = canvas.height = window.innerHeight;
    player.y = height - groundHeight - player.height;
  }
  window.addEventListener('resize', resize);
  resize();

  function startGame() {
    gameStarted = true;
    score = 0;
    gameSpeed = 6;
    obstacles = [];
    player.y = height - groundHeight - player.height;
    player.dy = 0;
    player.grounded = true;

    startBtn.style.display = 'none';
    restartBtn.style.display = 'none';
    scoreUI.textContent = 'Score: 0';

    requestAnimationFrame(gameLoop);
  }

  function jump() {
    if (!gameStarted) return;
    if (player.grounded) {
      player.dy = -player.jumpForce;
      player.grounded = false;
    }
  }

  function spawnObstacle() {
    const size = 30 + Math.random() * 40;
    obstacles.push({
      x: width,
      y: height - groundHeight - size,
      width: size,
      height: size,
      color: '#FF4500'
    });
  }

  function update() {
    player.dy += gravity;
    player.y += player.dy;

    if (player.y + player.height >= height - groundHeight) {
      player.y = height - groundHeight - player.height;
      player.dy = 0;
      player.grounded = true;
    }

    obstacles.forEach(ob => ob.x -= gameSpeed);
    obstacles = obstacles.filter(ob => ob.x + ob.width > 0);

    for (let ob of obstacles) {
      if (
        player.x < ob.x + ob.width &&
        player.x + player.width > ob.x &&
        player.y < ob.y + ob.height &&
        player.y + player.height > ob.y
      ) {
        endGame();
        break;
      }
    }

    score++;
    scoreUI.textContent = `Score: ${Math.floor(score / 10)}`;
  }

  function endGame() {
    gameStarted = false;
    restartBtn.style.display = 'block';
  }

  function draw() {
    ctx.clearRect(0, 0, width, height);

    // Background sky
    ctx.fillStyle = '#87ceeb';
    ctx.fillRect(0, 0, width, height);

    // Ground
    ctx.fillStyle = '#654321';
    ctx.fillRect(0, height - groundHeight, width, groundHeight);

    // Player
    ctx.fillStyle = player.color;
    ctx.fillRect(player.x, player.y, player.width, player.height);

    // Obstacles
    obstacles.forEach(ob => {
      ctx.fillStyle = ob.color;
      ctx.fillRect(ob.x, ob.y, ob.width, ob.height);
    });
  }

  function gameLoop() {
    if (!gameStarted) return;
    update();
    draw();
    requestAnimationFrame(gameLoop);
  }

  startBtn.onclick = () => startGame();
  restartBtn.onclick = () => {
    restartBtn.style.display = 'none';
    startGame();
  };

  // Jump on space key or touch/click
  document.addEventListener('keydown', e => {
    if (e.code === 'Space') jump();
  });

  canvas.addEventListener('touchstart', e => {
    e.preventDefault();
    jump();
  }, { passive: false });

  canvas.addEventListener('mousedown', e => {
    e.preventDefault();
    jump();
  });

  // Spawn obstacles every 1.5 seconds during game
  setInterval(() => {
    if (gameStarted) spawnObstacle();
  }, 1500);

  // Initially show start button, hide restart
  startBtn.style.display = 'block';
  restartBtn.style.display = 'none';

  scoreUI.textContent = 'Score: 0';
})();
</script>

</body>
</html>
